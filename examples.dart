import "dart:math" as w;import "dart:html" as BB;import "dart:async" as QB;class jC{static const  kC="Chrome";static const  lC="Firefox";static const  mC="Internet Explorer";static const  nC="Safari";final  XC;final  minimumVersion;const jC(this.XC,[this.minimumVersion]);}class oC{final  name;const oC(this.name);} lB( l){var g=new BB.ImageElement();g.onLoad.listen((m){var k=s(g)..canvas.classes.add('example');k.u(l);var i=BB.query("#hue");var h=BB.query("#saturation");var j=BB.query("#lightness");i.onChange.listen((rC)=>MB(g,i,h,j,k));h.onChange.listen((rC)=>MB(g,i,h,j,k));j.onChange.listen((rC)=>MB(g,i,h,j,k));});g.src='ships.png';} mB( h){var g,j;var m=0;QB.Future.wait([GB('below.png'),GB('above.png')]).then((k){g=k[0];j=k[1];var i=BB.query("#mix");SB(i,g,j,h);i.onChange.listen((rC){h.queryAll("canvas").forEach((l)=>l.remove());SB(i,g,j,h);});});} nB( h){h..appendHtml("using roundRect:<br />");s(300,150)..bC(10,10,280,130,50)..lineWidth=3..strokeStyle='red'..stroke()..fillStyle='blue'..fill()..canvas.title='.roundRect(10, 10, 280, 130, 50)'..u(h);var g=new BB.ImageElement();g.src='border.png';g.onLoad.listen((i){h..appendHtml("<br />using borderImage:<br />")..append(g)..appendHtml("<br />can be turned into<br />");s(300,150)..borderImage(g,0,0,300,150,6,6,6,6,fillColor:'red')..borderImage(g,15,15,240,50,6,6,6,6,fillColor:'green')..borderImage(g,15,75,240,50,6,6,6,6,fillColor:'blue')..borderImage(g,270,15,20,110,6,6,6,6,fill:true)..u(h)..canvas.title='''
..borderImage(image, 0, 0, 100, 100, 6, 6, 6, 6, fillColor: 'grey')
..borderImage(image, 15, 15, 240, 50, 6, 6, 6, 6, fillColor: 'green')
..borderImage(image, 15, 75, 240, 50, 6, 6, 6, 6, fillColor: 'blue')
..borderImage(image, 270, 15, 20, 110, 6, 6, 6, 6, fill: true);
''';});} oB( g){s(300,300)..font='16px Verdana'..fC('''Lorem ipsum dolor sit amet, consectetur adipiscing 
elit. In elementum sapien ac turpis tempus pellentesque. Nulla non tellus purus, 
in iaculis tortor. Integer facilisis varius nibh, sit amet tempus nunc hendrerit 
non. Maecenas arcu ante, semper eget venenatis eu, commodo sed purus. Vivamus a 
mi nunc, sed vestibulum lacus.''',20,40,260)..strokeRect(10,10,280,280)..canvas.title='.wrappedText(\'...\', 20, 40, 260);'..u(g);} pB( h){var g,i;var n=0;QB.Future.wait([GB('farminglpc.png'),GB('mask.png')]).then((j){g=j[0];i=j[1];h..append(g)..appendText('+')..append(i)..appendHtml('<br />=<br />');var k=s(i);var l=k.aC();var m=k.YC('#000000');s(g)..bB(l)..canvas.title='''
List<int> grayscaleMask = cq(maskImg).grayscaleToMask();\n
cq(image).applyMask(grayscaleMask)'''..u(h);s(g)..bB(m)..canvas.title='''
List<int> colorMask = cq(maskImg).colorToMask('#000000');\n
cq(image).applyMask(colorMask)'''..u(h);});} qB( h){var g=new BB.ImageElement();g.onLoad.listen((i){s(g)..canvas.classes.add('example')..canvas.title='This is the source image'..u(h);h.appendHtml('<br />');s(g)..canvas.classes.add('example')..blur()..canvas.title='.blur()'..u(h);s(g)..canvas.classes.add('example')..cC()..canvas.title='.sharpen()'..u(h);s(g)..canvas.classes.add('example')..DB([0,1,0,1,-4,1,0,1,0])..canvas.title='.convolve([0, 1, 0, 1, -4, 1, 0, 1, 0])'..u(h);s(g)..canvas.classes.add('example')..DB([1/2])..canvas.title='.convolve([1/2])'..u(h);s(g)..canvas.classes.add('example')..DB([2])..canvas.title='.convolve([2])'..u(h);s(g)..canvas.classes.add('example')..DB([1/2,2,1/9,2,1/9,-2,1/9,-2,-1/2])..canvas.title='.convolve([1/2, 2, 1/9, 2, 1/9, -2, 1/9, -2, -1/2])'..u(h);});g.src='farminglpc.png';}var RB={'coloring':lB,'blending':mB,'border':nB,'wrappedtext':oB,'masking':pB,'convolve':qB}; main(){BB.window.setImmediate((){RB.forEach((h,g)=>rB(h,g));});} SB( g, i, k, j){g.disabled=true;var l=double.parse(g.value);for(String h in TB.keys){sB(i,k,h,l,j);}for(String h in UB.keys){tB(i,k,h,l,j);}g.disabled=false;} rB( j, k){var h=BB.query("#show_${j}");h.onClick.listen((rC){RB.keys.forEach((i){BB.query("#${i}").style.display='none';BB.query("#show_${i}").classes.remove('highlight');});var g=BB.query("div#${j}");g.style.display='block';h.classes.add('highlight');if('true'!=g.dataset['init']){k(g);g.dataset['init']='true';}});} MB( l, m, k, n, o){var g=m.value;var i=k.value;var h=n.value;var j=s(l)..dC(hue:double.parse(g),saturation:double.parse(i),lightness:double.parse(h))..canvas.title='.shiftHsl(hue: ${g}, saturation: ${i}, lightness: ${h});'..canvas.classes.add('example');o.replaceWith(j);} sB(i,k, g, h, j){var l=TB[g];s(i)..cB(k,l,h)..u(j)..canvas.title='.blend(above, Blend.${g}, ${h});'..canvas.classes.add('example');} GB( i){var g=new BB.ImageElement();g.src=i;var h=new QB.Completer<BB.ImageElement>();g.onLoad.listen((j)=>h.complete(g));return h.future;} tB(i,k, g, h, j){var l=UB[g];s(i)..dB(k,l,h)..u(j)..canvas.title='.blendSpecial(above, Blend.${g}, ${h});'..canvas.classes.add('example');}var TB={'normal':p.uB,'overlay':p.VB,'hardLight':p.vB,'softLight':p.wB,'dodge':p.xB,'burn':p.yB,'multiply':p.zB,'divide':p.AC,'screen':p.BC,'grainExtract':p.CC,'grainMerge':p.DC,'difference':p.EC,'addition':p.FC,'substract':p.GC,'darkenOnly':p.HC,'lightenOnly':p.IC};var UB={'color':p.JC,'hue':p.KC,'value':p.LC,'saturation':p.MC};typedef  HB( a, b);typedef  IB( a, b);class p{static  uB( h, g)=>g;static  VB( g, h){g/= 255;h/= 255;var i=0;if(g<0.5)i=2*g*h;else i=1-2*(1-g)*(1-h);return w.min(255,w.max(0,i*255)).toInt();}static  vB( g, h)=>p.VB(h,g);static  wB( g, h){g/= 255;h/= 255;var i=((1-2*h)*g+2*h)*g;return EB((i*255).toInt(),0,255);}static  xB( g, h)=>w.min(256*g~/(255-h+1),255);static  yB( g, h)=>255-w.min(256*(255-g)~/(h+1),255);static  zB( g, h)=>h*g~/255;static  AC( g, h)=>w.min(256*g~/(h+1),255);static  BC( g, h)=>255-(255-h)*(255-g)~/255;static  CC( g, h)=>EB(g-h+128,0,255);static  DC( g, h)=>EB(g+h-128,0,255);static  EC( g, h)=>(g-h).abs();static  FC( g, h)=>w.min(g+h,255);static  GC( g, h)=>w.max(g-h,0);static  HC( g, h)=>w.min(g,h);static  IC( g, h)=>w.max(g,h);static  JC( h, i){var j=YB(h);var g=YB(i);return aB(g[0],g[1],j[2]);}static  KC( i, j){var g=CB(i);var h=CB(j);if(h[1]==0)return LB(g[0],g[1],g[2]);else return LB(h[0],g[1],g[2]);}static  LC( h, i){var g=CB(h);var j=CB(i);return LB(g[0],g[1],j[2]);}static  MC( h, i){var g=CB(h);var j=CB(i);return LB(g[0],j[1],g[2]);}} EB( g, h, i)=>g<h?h:g>i?i:g; NB( g, h, i)=>g+(h-g)*i; NC( g, h, i){if(g<h){g=i+(g-h);}else if(g>i){g=h+(g-i);}return g;}class JB{static  OC( g,var l, m,[ mix=1]){WB(g,l,mix,(i,j,h,k){RC(i,j,h,k,m);});}static  PC( g,var l, m,[ mix=1]){WB(g,l,mix,(i,j,h,k){QC(i,j,h,k,m);});}static  WB( g,var h, j, o( pixels, belowPixels, abovePixels, mix)){var m=g.context2d;var l=s(h).canvas.context2d;var k=m.getImageData(0,0,g.width,g.height);var n=l.getImageData(0,0,h.width,h.height);var i=XB(g.width,g.height);o(i.data,k.data,n.data,j);g.context2d.putImageData(i,0,0);}static QC( i, h, j, k, m){for(int g=0;g<h.length;g+= 4){var l=m([h[g+0],h[g+1],h[g+2]],[j[g+0],j[g+1],j[g+2]]);i[g+0]=h[g+0]+((l[0]-h[g+0])*k).toInt();i[g+1]=h[g+1]+((l[1]-h[g+1])*k).toInt();i[g+2]=h[g+2]+((l[2]-h[g+2])*k).toInt();i[g+3]=h[g+3];}}static RC( i, h, j, k, l){for(int g=0;g<h.length;g+= 4){var m=l(h[g+0],j[g+0]);var n=l(h[g+1],j[g+1]);var o=l(h[g+2],j[g+2]);i[g+0]=h[g+0]+((m-h[g+0])*k).toInt();i[g+1]=h[g+1]+((n-h[g+1])*k).toInt();i[g+2]=h[g+2]+((o-h[g+2])*k).toInt();i[g+3]=h[g+3];}}static  SC( g){var h=new BB.CanvasElement(width:g.width,height:g.height);h.context2d.drawImage(g,0,0);return h;}static  XB( g, h){return new BB.CanvasElement().context2d.createImageData(g,h);}} s([var selector, height]){var g;if(null==selector||selector is int){var h=(selector!=null?selector:BB.window.innerWidth);height=(height!=null?height:BB.window.innerHeight);g=new BB.CanvasElement(width:h,height:height);}else if(selector is String){g=BB.query(selector);}else if(selector is BB.ImageElement){g=JB.SC(selector);}else if(selector is KB){return selector;}else{g=selector;}return new KB(g);}class KB implements BB.CanvasRenderingContext2D{var sC;var tC; get canvas=>sC; get context2d=>tC;KB(this.sC){tC=sC.context2d;} noSuchMethod( g)=>g.invokeOn(tC); u( g){g.append(sC);} replaceWith( g){sC.replaceWith(g.canvas);sC=g.canvas;tC=g.context2d;} cB(var g, h,[ mix=1]){if(g is String){blendColor(g,h,mix);}else{JB.OC(this.canvas,g,h,mix);}} blendColor( g, h,[ mix=1])=>cB(uC(g),h,mix); dB(var g, h,[ mix=1]){if(g is String){WC(g,h,mix);}else{JB.PC(this.canvas,g,h,mix);}} WC( g, h,[ mix=1])=>dB(uC(g),h,mix); uC( g)=>new BB.CanvasElement(width:sC.width,height:sC.height)..context2d.fillStyle=g..context2d.fillRect(0,0,sC.width,sC.height); ZC( l, j, g, h){var i=new BB.CanvasElement(width:g,height:h);var k=i.context2d;k.drawImageScaledFromSource(sC,l,j,g,h,0,0,g,h);sC.width=g;sC.height=h;clear();tC.drawImage(i,0,0);} trim({ color}){var l;var m;if(color!=null){m=new TC.qC(color).eC();l=m[4]==255?true:false;}else l=true;var n=tC.getImageData(0,0,sC.width,sC.height);var i=n.data;var g=[sC.width,sC.height,0,0];for(var h=0,o=i.length;h<o;h+= 4){if(l){if(i[h+3]==0)continue;}else if(i[h+0]==color[0]&&i[h+1]==color[1]&&i[h+2]==color[2])continue;var j=(h~/4)%sC.width;var k=(h~/4)~/sC.width;if(j<g[0])g[0]=j;if(j>g[2])g[2]=j;if(k<g[1])g[1]=k;if(k>g[3])g[3]=k;}if(g[2]==0||g[3]==0){}else{ZC(g[0],g[1],g[2]-g[0]+1,g[3]-g[1]+1);}} YC( l,{ inverted: false}){var i=new TC.qC(l);var k=tC.getImageData(0,0,sC.width,sC.height);var h=k.data;var j=new List<bool>(h.length~/4);for(var g=0;g<h.length;g+= 4){if(h[g+0]==i.r&&h[g+1]==i.OB&&h[g+2]==i.b)j[g~/4]=inverted;else j[g~/4]=!inverted;}return j;} aC(){var j=tC.getImageData(0,0,sC.width,sC.height);var h=j.data;var i=new List<int>(h.length~/4);for(var g=0;g<h.length;g+= 4){i[g~/4]=(h[g+0]+h[g+1]+h[g+2])~/3;}return i;} bB( j){var i=tC.getImageData(0,0,sC.width,sC.height);var h=i.data;var l=j is List<bool>?"bool":"byte";for(var g=0,m=h.length;g<m;g+= 4){var k=j[g~/4];if(l=="bool")h[g+3]=k?255:0;else h[g+3]=k;}tC.putImageData(i,0,0);} clear({ color}){if(null!=color){tC.fillStyle=color;tC.fillRect(0,0,sC.width,sC.height);}else{tC.clearRect(0,0,sC.width,sC.height);}} dC({ hue, saturation, lightness}){var n=null==hue?null:hue.toDouble();var t=null==saturation?null:saturation.toDouble();var k=null==lightness?null:lightness.toDouble();var l=tC.getImageData(0,0,sC.width,sC.height);var h=l.data;var q,m,o;var i;var j;for(var g=0,v=h.length;g<v;g+= 4){i=ZB(h[g+0],h[g+1],h[g+2]);q=n==null?i[0]:NC(i[0]+n,0.0,1.0);m=t==null?i[1]:EB(i[1]+t,0.0,1.0);o=k==null?i[2]:EB(i[2]+k,0.0,1.0);j=aB(q,m,o);h[g+0]=j[0];h[g+1]=j[1];h[g+2]=j[2];}tC.putImageData(l,0,0);} bC( h, g, j, k, i){tC..beginPath()..moveTo(h+i,g)..lineTo(h+j-i,g)..quadraticCurveTo(h+j,g,h+j,g+i)..lineTo(h+j,g+k-i)..quadraticCurveTo(h+j,g+k,h+j-i,g+k)..lineTo(h+i,g+k)..quadraticCurveTo(h,g+k,h,g+k-i)..lineTo(h,g+i)..quadraticCurveTo(h,g,h+i,g)..closePath();} fC( i, q, t,[ maxWidth]){var n=i.split(" ");var AB=new RegExp(r"(\d+)");var v=int.parse(AB.firstMatch(font).group(0))*2;var j=0;var m=0;var h=new List<String>.from([""]);if(null!=maxWidth){var k=0;for(var g=0;g<n.length;g++ ){var o="${n[g]} ";var l=tC.measureText(o).width;if(j+l>maxWidth){h.add("");k++ ;j=0;}h[k]="${h[k]}${o}";j+= l;}}else{h=[i];}for(var g=0;g<h.length;g++ ){var m=(t+g*v*0.6).toInt();var i=h[g];tC.fillText(i,q,m);}} borderImage(var g, l, m, n, o, i, k, j, h,{ fill: false, fillColor}){tC..drawImageScaledFromSource(g,h,0,g.width-h-k,i,l+h,m,n-h-k,i)..drawImageScaledFromSource(g,h,g.height-j,g.width-h-k,j,l+h,m+o-j,n-h-k,j)..drawImageScaledFromSource(g,0,i,h,g.height-j-i,l,m+i,h,o-j-i)..drawImageScaledFromSource(g,g.width-k,i,k,g.height-j-i,l+n-k,m+i,k,o-j-i)..drawImageScaledFromSource(g,0,0,h,i,l,m,h,i)..drawImageScaledFromSource(g,g.width-k,0,k,i,l+n-k,m,k,i)..drawImageScaledFromSource(g,g.width-k,g.height-j,k,j,l+n-k,m+o-j,k,j)..drawImageScaledFromSource(g,0,g.height-j,h,j,l,m+o-j,h,j);if(null!=fillColor){tC..fillStyle=fillColor..fillRect(l+h,m+i,n-h-k,o-i-j);}else if(fill){tC.drawImageScaledFromSource(g,h,i,g.width-k-h,g.height-j-i,l+h,m+i,n-h-k,o-i-j);}} DB( AB,{ mix: 1, divide: 1}){var PB=tC.getImageData(0,0,sC.width,sC.height);var i=(w.sqrt(AB.length)+0.5).toInt();var eB=i~/2;var h=PB.data;var v=PB.width;var fB=PB.height;var gB=v;var gC=fB;var hB=JB.XB(sC.width,sC.height);var q=hB.data;var hC=divide==1?AB:vC(AB,i,divide);for(var j=1;j<gC-1;j++ ){for(var o=1;o<gB-1;o++ ){var g=(j*gB+o)*4;var iB=0.0,jB=0.0,kB=0.0,iC=0.0;for(var m=0;m<i;m++ ){for(var k=0;k<i;k++ ){var t=j+m-eB;var FB=o+k-eB;if(t>=0&&t<fB&&FB>=0&&FB<v){var l=(t*v+FB)*4;var n=hC[m*i+k];iB+= h[l+0]*n;jB+= h[l+1]*n;kB+= h[l+2]*n;iC+= h[l+3]*n;}}}q[g+0]=NB(h[g+0],iB,mix).toInt();q[g+1]=NB(h[g+1],jB,mix).toInt();q[g+2]=NB(h[g+2],kB,mix).toInt();q[g+3]=h[g+3];}}tC.putImageData(hB,0,0);} vC( k, h, m){var j=new List<double>(k.length);for(var g=0;g<h;g++ ){for(var i=0;i<h;i++ ){var l=g*h+i;j[l]=k[l]/m;}}return j;} blur({ mix: 1})=>DB([1,1,1,1,1,1,1,1,1],mix:mix,divide:9); cC({ mix: 1})=>DB([0,-1,0,-1,5,-1,0,-1,0],mix:mix);}class TC{var r,OB,b,a;TC.qC( h,[this.a=255]){var g=UC(h);r=g[0];OB=g[0];b=g[0];} eC()=>[r,OB,b,a];} UC( g){return [int.parse('0x${g[1]}${g[2]}'),int.parse('0x${g[3]}${g[4]}'),int.parse('0x${g[5]}${g[6]}')];} YB( g)=>ZB(g[0],g[1],g[2]); ZB( v, q, t){final  k=v/255;final  j=q/255;final  h=t/255;var g=w.max(w.max(k,j),h),l=w.min(w.min(k,j),h);var i,n,o=(g+l)/2;if(g==l){i=n=0.0;}else{var m=g-l;n=o>0.5?m/(2-g-l):m/(g+l);switch (g){case k:i=(j-h)/m+(j<h?6:0);break;case j:i=(h-k)/m+2;break;case h:i=(k-j)/m+4;break;}i/= 6;}return [i,n,o];} aB( v, t, AB){var m=v.toDouble();var k=t.toDouble();var j=AB.toDouble();var l;var n;var o;if(k==0.0){l=n=o=j;}else{var q=( h, i, g){if(g<0)g+= 1;if(g>1)g-= 1;if(g<1/6)return h+(i-h)*6*g;if(g<1/2)return i;if(g<2/3)return h+(i-h)*(2/3-g)*6;return h;};var i=j<0.5?j*(1+k):j+k-j*k;var h=2*j-i;l=q(h,i,m+1/3);n=q(h,i,m);o=q(h,i,m-1/3);}return [(l*255+0.5).toInt(),(n*255+0.5).toInt(),(o*255+0.5).toInt()];} CB( g)=>VC(g[0],g[1],g[2]); VC( t, o, q){final  k=t/255;final  j=o/255;final  h=q/255;var g=w.max(w.max(k,j),h),m=w.min(w.min(k,j),h);var i,n,v=g.toDouble();var l=g-m;n=g==0.0?0.0:l/g;if(g==m){i=0.0;}else{switch (g){case k:i=(j-h)/l+(j<h?6:0);break;case j:i=(h-k)/l+2;break;case h:i=(k-j)/l+4;break;}i/= 6;}return [i,n,v];} LB( AB, v, FB){var o=AB.toDouble();var m=v.toDouble();var g=FB.toDouble();var h,i,j;var t=(o*6).toInt();var q=o*6-t;var k=g*(1-m);var n=g*(1-q*m);var l=g*(1-(1-q)*m);switch (t%6){case 0:h=g;i=l;j=k;break;case 1:h=n;i=g;j=k;break;case 2:h=k;i=g;j=l;break;case 3:h=k;i=n;j=g;break;case 4:h=l;i=k;j=g;break;case 5:h=g;i=k;j=n;break;}return [(h*255+0.5).toInt(),(i*255+0.5).toInt(),(j*255+0.5).toInt()];}//@ sourceMappingURL=out.dart.map
